<div class="max__w__1280">
    <div class="tab-content">
        <ng-container *ngIf="study$ | async as studies">
            <div *ngIf="studies.length != 0">
                <div *ngFor="let study of studies" class="bg__white cards box__shadow-cmn ml-none mr-none studies_row">
                    <div class="flex__ flex__row">
                        <div class="img__container__left" *ngIf="study.logo">
                            <img [src]="study.logo" alt="" />
                        </div>
                        <div class="width__100">
                            <div class="row">
                                <div class="col-xs-12 col-md-12 p-none dashboard-card__title cursor__pointer">
                                    {{ study.customId }}
                                </div>
                                <div class="text-grey__sm row flex-wrap-unset col-xs-12 col-md-12 p-none">
                                    <div class="col-xs-6 col-md-3 p-none">
                                        <span
                                            *ngIf="study.type != 'OPEN'">{{ study.sites.length | i18nPlural: messageMapping }}
                                        </span>
                                        <span *ngIf="study.type == 'OPEN'">Open Study</span>
                                    </div>
                                    <div class="col-xs-6 col-md-9 text-right p-none mb__display__none">
                                        Enrolled /
                                        <span *ngIf="study.type != 'OPEN'">Invited</span>
                                        <span *ngIf="study.type == 'OPEN'">Target</span>
                                    </div>
                                </div>
                                <div class="col-xs-12 col-md-12 p-none border__bottom__red progress__bar">
                                    <div *ngFor="let site of study.sites"
                                        class="row display-flex-center progress__bar__row " (click)="
                                      study.type != 'OPEN'
                                        ? navigateToParticipantList('site', site.id)
                                        : navigateToParticipantList('study', study.id)
                                    ">
                                        <div class="col-xs-12 col-md-8 p-none cursor__pointer">
                                            <span *ngIf="study.type != 'OPEN'" class="sites_row">{{ site.name }}</span>
                                            <span *ngIf="study.type == 'OPEN'">Enrollment Registry</span>
                                        </div>
                                        <div class="col-xs-12 col-md-4 p-none lh__6">
                                            <div class="prog">
                                                <div class="pro__base">
                                                    <div *ngIf="site.invitedCount != 0">
                                                        <div class="pro__top"
                                                            [style.width.%]="site.enrollmentPercentage"></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="progress-label font__bold" [ngClass]="progressBarColor(site)">
                                                <div>
                                                    <span *ngIf="site.invitedCount != 0"
                                                        class="enrolled">{{ site.enrolledCount }} /
                                                        {{ site.invitedCount }}</span>
                                                    <span *ngIf="site.invitedCount == 0">N/A</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div *ngIf="
                                  study.type != 'OPEN' &&
                                  study.studyPermission == 2
                                ">
                                <button name="add" class="primary__btn add__site"
                                    (click)="openAddSiteModal(template, study)">
                                    + Add Site
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </ng-container>
    </div>
</div>
<ng-template #template>
    <div class="modal-body modal__body">
        <div class="row border__bottom__c4d1e6 background__dfe4ec">
            <div class="col-xs-12 col-md-5 p-none">
                <div class="form-group">
                    <label for="study">study</label>
                    <div>{{ newSite.customId }}</div>
                </div>
            </div>
            <div class="col-xs-12 col-md-7 p-none">
                <div class="form-group">
                    <label for="app">app</label>
                    <div>{{ newSite.appId }}</div>
                </div>
            </div>
        </div>
        <form ngForm #addSiteForm="ngForm" autocomplete="off">
            <div class="row border__bottom__c4d1e6">
                <div class="col-xs-12 col-md-12 p-none">
                    <div class="form-group">
                        <div class="form-item">
                            <label for="Location">Location</label>
                            <div class="select-wrap">
                                <select class="form-item__element form-item__element--select"
                                    [(ngModel)]="site.locationId" required name="location" #location="ngModel">
                                    <option disabled selected>Select Location</option>
                                    <option class="cursor__pointer" *ngFor="let location of locations"
                                        value="{{ location.id }}">
                                        {{ location.name }}</option>
                                </select>
                            </div>
                        </div>
                        <div *ngIf="location.dirty || location.touched">
                            <span class="help-block with-errors error__msg" *ngIf="
                  site.locationId == '' || site.locationId == null || site.locationId == 0
                "> Please fill out this field.
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="p-xlg">
                <button type="submit" [disabled]="addSiteForm.form.invalid" class="btn bt__add mr-sm"
                    (click)="addSite()">
                    Add
                </button>
                <button type="button" class="btn bt__cancel" (click)="modalRef.hide()">
                    Cancel
                </button>
            </div>
        </form>
    </div>
</ng-template>